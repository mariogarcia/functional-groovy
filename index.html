<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.4">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Functional Groovy</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }
audio, canvas, video { display: inline-block; }
audio:not([controls]) { display: none; height: 0; }
[hidden] { display: none; }
html { background: #fff; color: #000; font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; }
body { margin: 0; }
a:focus { outline: thin dotted; }
a:active, a:hover { outline: 0; }
h1 { font-size: 2em; margin: 0.67em 0; }
abbr[title] { border-bottom: 1px dotted; }
b, strong { font-weight: bold; }
dfn { font-style: italic; }
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }
mark { background: #ff0; color: #000; }
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }
pre { white-space: pre-wrap; }
q { quotes: "\201C" "\201D" "\2018" "\2019"; }
small { font-size: 80%; }
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
img { border: 0; }
svg:not(:root) { overflow: hidden; }
figure { margin: 0; }
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }
legend { border: 0; padding: 0; }
button, input, select, textarea { font-family: inherit; font-size: 100%; margin: 0; }
button, input { line-height: normal; }
button, select { text-transform: none; }
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; cursor: pointer; }
button[disabled], html input[disabled] { cursor: default; }
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; padding: 0; }
input[type="search"] { -webkit-appearance: textfield; -moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box; }
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }
textarea { overflow: auto; vertical-align: top; }
table { border-collapse: collapse; border-spacing: 0; }
*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
html, body { font-size: 100%; }
body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }
a:hover { cursor: pointer; }
a:focus { outline: none; }
img, object, embed { max-width: 100%; height: auto; }
object, embed { height: 100%; }
img { -ms-interpolation-mode: bicubic; }
#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }
.left { float: left !important; }
.right { float: right !important; }
.text-left { text-align: left !important; }
.text-right { text-align: right !important; }
.text-center { text-align: center !important; }
.text-justify { text-align: justify !important; }
.hide { display: none; }
.antialiased, body { -webkit-font-smoothing: antialiased; }
img { display: inline-block; vertical-align: middle; }
textarea { height: auto; min-height: 50px; }
select { width: 100%; }
p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }
.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #7a2518; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
a { color: #005498; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #00467f; }
a img { border: none; }
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Georgia, "URW Bookman L", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }
h1 { font-size: 2.125em; }
h2 { font-size: 1.6875em; }
h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }
h4 { font-size: 1.125em; }
h5 { font-size: 1.125em; }
h6 { font-size: 1em; }
hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }
em, i { font-style: italic; line-height: inherit; }
strong, b { font-weight: bold; line-height: inherit; }
small { font-size: 60%; line-height: inherit; }
code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; color: #6d180b; }
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }
ul, ol { margin-left: 1.5em; }
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }
abbr { text-transform: none; }
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: inherit; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }
blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }
.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }
@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
.print-only { display: none !important; }
@media print { * { background: transparent !important; color: #000 !important; box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }
.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }
*:not(pre) > code { font-size: 0.9375em; padding: 1px 3px 0; white-space: nowrap; background-color: #f2f2f2; border: 1px solid #cccccc; -webkit-border-radius: 4px; border-radius: 4px; text-shadow: none; }
pre, pre > code { line-height: 1.4; color: inherit; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }
kbd.keyseq { color: #555555; }
kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }
kbd kbd:first-child { margin-left: 0; }
kbd kbd:last-child { margin-right: 0; }
.menuseq, .menu { color: #090909; }
p a > code:hover { color: #561309; }
#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }
#header { margin-bottom: 2.5em; }
#header > h1 { color: black; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }
#toc { border-bottom: 3px double #ebebeb; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }
#toctitle { color: #7a2518; }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #ebebeb; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul { font-size: .95em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #ebebeb; left: auto; right: 0; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }
#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }
#footer-text { color: #dddddd; line-height: 1.44; }
.sect1 { padding-bottom: 1.25em; }
.sect1 + .sect1 { border-top: 3px double #ebebeb; }
#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }
.imageblock, .literalblock, .listingblock, .verseblock, .videoblock { margin-bottom: 1.25em; }
.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }
.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }
.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }
.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }
.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; line-height: 1.6; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }
.literalblock > .content pre, .listingblock > .content pre { background: none; border-width: 1px 0; border-style: dotted; border-color: #bfbfbf; -webkit-border-radius: 4px; border-radius: 4px; padding: 0.75em 0.75em 0.5em 0.75em; word-wrap: break-word; }
.literalblock > .content pre.nowrap, .listingblock > .content pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content pre > code, .listingblock > .content pre > code { display: block; }
@media only screen { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.8em; } }
@media only screen and (min-width: 768px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.9em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 1em; } }
.listingblock > .content { position: relative; }
.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }
.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }
.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }
.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }
table.pyhltable { border: 0; margin-bottom: 0; }
table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }
table.pyhltable td.code { padding-left: .75em; padding-right: 0; }
.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }
.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }
table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }
.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: inherit; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }
table thead th, table tfoot th { font-weight: bold; }
table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 4px; border-radius: 4px; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }
table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }
table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }
table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }
th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }
th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }
th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }
th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }
th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }
th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }
p.tableblock.header { color: #222222; font-weight: bold; }
td > div.verse { white-space: pre; }
ol { margin-left: 1.75em; }
ul li ol { margin-left: 1.5em; }
dl dd { margin-left: 1.125em; }
dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }
ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }
ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }
ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }
ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }
ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }
ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }
.unstyled dl dt { font-weight: normal; font-style: normal; }
ol.arabic { list-style-type: decimal; }
ol.decimal { list-style-type: decimal-leading-zero; }
ol.loweralpha { list-style-type: lower-alpha; }
ol.upperalpha { list-style-type: upper-alpha; }
ol.lowerroman { list-style-type: lower-roman; }
ol.upperroman { list-style-type: upper-roman; }
ol.lowergreek { list-style-type: lower-greek; }
.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }
td.hdlist1 { padding-right: .8em; font-weight: bold; }
td.hdlist1, td.hdlist2 { vertical-align: top; }
.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }
.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }
.qanda > ol > li > p > em:only-child { color: #00467f; }
.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }
.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }
a.image { text-decoration: none; }
span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }
.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }
div.unbreakable { page-break-inside: avoid; }
.big { font-size: larger; }
.small { font-size: smaller; }
.underline { text-decoration: underline; }
.overline { text-decoration: overline; }
.line-through { text-decoration: line-through; }
.aqua { color: #00bfbf; }
.aqua-background { background-color: #00fafa; }
.black { color: black; }
.black-background { background-color: black; }
.blue { color: #0000bf; }
.blue-background { background-color: #0000fa; }
.fuchsia { color: #bf00bf; }
.fuchsia-background { background-color: #fa00fa; }
.gray { color: #606060; }
.gray-background { background-color: #7d7d7d; }
.green { color: #006000; }
.green-background { background-color: #007d00; }
.lime { color: #00bf00; }
.lime-background { background-color: #00fa00; }
.maroon { color: #600000; }
.maroon-background { background-color: #7d0000; }
.navy { color: #000060; }
.navy-background { background-color: #00007d; }
.olive { color: #606000; }
.olive-background { background-color: #7d7d00; }
.purple { color: #600060; }
.purple-background { background-color: #7d007d; }
.red { color: #bf0000; }
.red-background { background-color: #fa0000; }
.silver { color: #909090; }
.silver-background { background-color: #bcbcbc; }
.teal { color: #006060; }
.teal-background { background-color: #007d7d; }
.white { color: #bfbfbf; }
.white-background { background-color: #fafafa; }
.yellow { color: #bfbf00; }
.yellow-background { background-color: #fafa00; }
span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }
.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #005498; color: #003f72; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 0; border-radius: 0; }

</style>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Functional Groovy</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_intro">1. Intro</a></li>
<li><a href="#_closures">2. Closures</a></li>
<li><a href="#_internal_vs_external_iteration">3. Internal Vs External iteration</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_more_concise">3.1. More concise</a></li>
<li><a href="#_reusability">3.2. Reusability</a></li>
</ul>
</li>
<li><a href="#_streams">4. Streams</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_mind_the_lazyness">4.1. Mind the lazyness</a></li>
<li><a href="#_stream_groovy">4.2. stream-groovy</a></li>
<li><a href="#_creating_a_stream">4.3. Creating a Stream</a></li>
<li><a href="#_nba_time">4.4. NBA time</a></li>
</ul>
</li>
<li><a href="#_oop_revisited">5. OOP Revisited</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_replacing_functional_interface">5.1. Replacing Functional Interface</a></li>
<li><a href="#_state">5.2. State</a></li>
<li><a href="#_command">5.3. Command</a></li>
<li><a href="#_immutable_objects_instead_of_builder">5.4. Immutable objects instead of Builder</a></li>
<li><a href="#_replacing_iterator">5.5. Replacing Iterator</a></li>
<li><a href="#_template_pattern">5.6. Template pattern</a></li>
<li><a href="#_strategy">5.7. Strategy</a></li>
</ul>
</li>
<li><a href="#_functional_patterns">6. Functional Patterns</a></li>
<li><a href="#_the_m_word">7. The M-Word</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_intro">1. Intro</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(TODO)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_closures">2. Closures</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(TODO)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_internal_vs_external_iteration">3. Internal Vs External iteration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most of the time we need to iterate through a list, we end doing the same. We tend to specify every detail, we code
every step of the way. But is there any other way ? Well there is&#8230;it&#8217;s call internal iteration.</p>
</div>
<div class="paragraph">
<p>The point here is that We should be taking care on the logic of filtering and transformation and not
how to loop through the collection, Don&#8217;t you thing ?</p>
</div>
<div class="paragraph">
<p>There are some reasons I would recommend you to start using internal iteration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Is more concise and clear</p>
</li>
<li>
<p>Reusability</p>
</li>
<li>
<p>Internal optimizations</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_more_concise">3.1. More concise</h3>
<div class="paragraph">
<p>Let&#8217;s say we have a list of mercenaries in lower case and we want to get their names in upper case. Well
no problem&#8230;That is what is should look like in old-fashioned Java code:</p>
</div>
<div class="listingblock">
<div class="title">External Iteration: Java style</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'External iteration. Java like code'() {
    given: 'A collection we want to iterate'
        def expendables = ['Stallone', 'Staham', 'Couture']
    when: 'Collecting the upper case version of the names'
        def expendablesUpperCase = []
        for(String name: expendables) {
            expendablesUpperCase &lt;&lt; name.toUpperCase()
        }
    then: 'All names should be in upper case'
      expendablesUpperCase == ['STALLONE', 'STAHAM', 'COUTURE']
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>We have to remember to create the collection to store the transformed names.</p>
</li>
<li>
<p>Then we should know how the iteration is done</p>
</li>
<li>
<p>Finally to add explicitly every transformed name into the new collection.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Maybe Groovy is more concise and less verbose&#8230;hell yeah but you can do it wrong either.</p>
</div>
<div class="listingblock">
<div class="title">External Iteration: Groovy style</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'External iteration. Groovy style code'() {
    given: 'A collection we want to iterate'
        def expendables = ['Stallone', 'Staham', 'Couture']
    when: 'Collecting the upper case version of the names'
        def expendablesUpperCase = []
        expendables.each { name -&gt;
            expendablesUpperCase &lt;&lt; name.toUpperCase()
        }
    then: 'All names should be in upper case'
      expendablesUpperCase == ['STALLONE', 'STAHAM', 'COUTURE']
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>"That&#8217;s not what I signed for!!!"</em> you may think. Don&#8217;t worry Groovy has a lot more to offer. Collections
in Groovy have many useful method to loop through them filtering and collecting transformed values
without having to specify how a collection should be traversed.</p>
</div>
<div class="listingblock">
<div class="title">Internal Iteration: Groovy</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Internal iteration'() {
    given: 'A collection we want to iterate'
        def expendables = ['Stallone', 'Staham', 'Couture']
        def upperCaseVersion = { String word -&gt; word.toUpperCase() }
    when: 'Collecting the upper case version of the names'
        def upperCaseExpendables = expendables.collect(upperCaseVersion)
    then: 'All names should be in upper case'
      upperCaseExpendables == ['STALLONE', 'STAHAM', 'COUTURE']
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows how you can loop through a collection in Groovy in a declarative way. You can almost
read <em>"I want to collect the upper-case-version of the expendable collection"</em> can&#8217;t you ?</p>
</div>
<div class="paragraph">
<p>Of course you can embed the closure expression as a parameter instead of declaring the expression and
then passing it to the collect method</p>
</div>
<div class="listingblock">
<div class="title">Internal Iteration: Groovy</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Internal iteration'() {
    given: 'A collection we want to iterate'
        def expendables = ['Stallone', 'Staham', 'Couture']
    when: 'Collecting the upper case version of the names'
        def upperCaseVersion = expendables.collect { it.toUpperCase() }
    then: 'All names should be in upper case'
      upperCaseVersion == ['STALLONE', 'STAHAM', 'COUTURE']
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>But later on you&#8217;ll see that sometimes is better not to use the Closure expression directly if you
want to keep your code reusable.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reusability">3.2. Reusability</h3>
<div class="paragraph">
<p>Imagine we had a method looping through a collection to sum all numbers less than 20.</p>
</div>
<div class="listingblock">
<div class="title">Internal Iteration: Groovy</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'external iteration: adding up all numbers from a given collection'() {
    given: 'a collection of numbers'
        def numbers = (0..1000)
        def sum = 0
    when: 'summing all of them'
        numbers.each { nextnumber -&gt;
            sum += nextnumber
        }
    then: 'the expected result should be the expected'
        sum == 500500
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we want to get all numbers from 20 to 100</p>
</div>
<div class="listingblock">
<div class="title">Internal Iteration: Groovy</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'External iteration: Adding numbers from 20 to 100 from a given collection'() {
    given: 'a collection of numbers'
        def numbers = (0..1000)
        def sum = 0
    when: 'adding up all of them'
        numbers.each { nextnumber -&gt;
            if (nextnumber &gt; 20 &amp;&amp; nextnumber &lt; 100) {
                sum += nextnumber
            }
        }
    then: 'the expected result should be the expected'
        sum == 4740
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now&#8230;you know what ? forget it :P</p>
</div>
<div class="paragraph">
<p>There should be a better way of refactoring this behavior. There are two main actions when trying to
solve these type of problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Filtering data</p>
</li>
<li>
<p>Transforming data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And when talking about Groovy and collections this means to use <strong><em>find</em></strong> or <strong><em>findAll</em></strong> when trying
to filtering data and <strong><em>collect</em></strong> for transforming data.</p>
</div>
<div class="paragraph">
<p>Back to the prolem, while the transformation applied to the data is the same the filtering applied
is different. Lets see how our reusable method should look like:</p>
</div>
<div class="listingblock">
<div class="title">Internal Iteration: Filter + Transformation</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>Integer sum(
    final Collection&lt;Integer&gt; source, <i class="conum" data-value="1"></i><b>(1)</b>
    final Closure&lt;Boolean&gt; filter = { it }) { <i class="conum" data-value="2"></i><b>(2)</b>

    return source.findAll(filter).sum() <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>First we pass the collection we want to transform. We say transform deliberately, we don&#8217;t want
to <strong><em>mutate</em></strong> the collection but to create a new one for applying a given action. This case to sum
all numbers of that new collection</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We want to get certain numbers to add them up. By default if no filter given then apply to all (<strong><em>{ it }</em></strong>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We&#8217;re using Groovy&#8217;s collection behavior to apply the given filter to get the new collection and
then sum all numbers in that collection.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And how to use it for different filters:</p>
</div>
<div class="listingblock">
<div class="title">Internal Iteration: Reuse of functions</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Internal iteration: Adding up with reusability'() {
    given: 'A collection of numbers'
        def numbers = (0..1000)
    when: 'adding up'
        def all = sum(numbers)
        def from20To100 = sum(numbers) {
            it &gt; 20 &amp;&amp; it &lt; 100
        }
    then: 'Results should be the expected'
        all == 500500
        from20To100 == 4740
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s great but the previous example shows us a way of reusing behavior through the use of methods.
But Does it mean it will be forcing us to create a method every time we would like to reuse a
certain behavior ? That would lead us to create a lot of methods don&#8217;t you think ?</p>
</div>
<div class="paragraph">
<p>Functional programming teach us that behavior is not limited to <strong><em>methods</em></strong> of an object. When
talking about behavior we will be talking of <strong><em>functions</em></strong> in a more general way.</p>
</div>
<div class="paragraph">
<p>Functions are more powertful in the way that they can be modified, passed as a parameter to other
functions, and still can be used as the methods we normally use. In Groovy such type of functions
are called <strong><em>closures</em></strong>.</p>
</div>
<div class="paragraph">
<p>Although we will be talking about <strong><em>closures</em></strong> deeper in its own chapter lets say for now that
they&#8217;re extremely useful to reuse behavior.</p>
</div>
<div class="paragraph">
<p>What if I want to use the same method with the same type of filter several times in the same
method. That would be a lot of boiler plate code. A lot of code to maintain and repeat. Sounds
too dirty&#8230; and looks worst :P</p>
</div>
<div class="listingblock">
<div class="title">Internal Iteration: Reusability limited to methods ?</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Internal iteration: Reusability limited ?'() {
    given: 'A collection of numbers'
        def numbers1 = [100, 20, 2, 54, 33, 14]
        def numbers2 = [100, 20, 2, 54, 33, 14]
        def numbers3 = [100, 24, 6, 48, 22, 40]
    when: 'adding up all numbers of first collection'
        def numbers1Sum = sum(numbers1)
    and: 'adding up numbers &gt; 20 and &lt; 100 for the remaining collections'
        def numbers2Sum = sum(numbers2) {
            it &gt; 20 &amp;&amp; it &lt; 100
        }
        def numbers3Sum = sum(numbers3) {
            it &gt; 20 &amp;&amp; it &lt; 100
        }
    then: 'Results should be the expected'
        numbers1Sum == 223
        numbers2Sum == 87
        numbers3Sum == 134
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>What can I do ? Well let&#8217;s say that Groovy methods could be transformed into <strong><em>closures</em></strong>&#8230; How ?
As I said earlier <strong><em>functions</em></strong> / <strong><em>closures</em></strong> can be assigned and be passed as parameters.</p>
</div>
<div class="listingblock">
<div class="title">Internal Iteration: Reusability limited to methods ?</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Internal iteration: Reusability limited ?'() {
    given: 'A collection of numbers'
        def numbers1 = [100, 20, 2, 54, 33, 14]
        def numbers2 = [100, 20, 2, 54, 33, 14]
        def numbers3 = [100, 24, 6, 48, 22, 40]
    and: 'A fixed type of filter'
        def greaterThan20LessThan100 = { it &gt; 20 &amp;&amp; it &lt; 100} <i class="conum" data-value="1"></i><b>(1)</b>
    when: 'adding up all numbers of first collection'
        def numbers1Sum = sum(numbers1)
    and: 'adding up numbers &gt; 20 and &lt; 100 for the remaining collections'
        def numbers2Sum = sum(numbers2, greaterThan20LessThan100) <i class="conum" data-value="2"></i><b>(2)</b>
        def numbers3Sum = sum(numbers3, greaterThan20LessThan100)
    then: 'Results should be the expected'
        numbers1Sum == 223
        numbers2Sum == 87
        numbers3Sum == 134
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We assign the closure representing the <strong><em>filter</em></strong> to a given variable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Then we pass the closure as parameter to filter numbers</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And also I said <strong><em>methods</em></strong> in Groovy can be transformed to closures:</p>
</div>
<div class="listingblock">
<div class="title">Internal Iteration: Reusability limited to methods ?</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Internal iteration: Reusability limited ?'() {
    given: 'A collection of numbers'
        def numbers1 = [100, 20, 2, 54, 33, 14]
        def numbers2 = [100, 20, 2, 54, 33, 14]
        def numbers3 = [100, 24, 6, 48, 22, 40]
    and: 'A fixed type of behavior'
        def customSum = this.&amp;sum.rcurry { it &gt; 20 &amp;&amp; it &lt; 100} <i class="conum" data-value="1"></i><b>(1)</b>
    when: 'adding up all numbers of first collection'
        def numbers1Sum = sum(numbers1)
    and: 'adding up numbers &gt; 20 and &lt; 100 for the remaining collections'
        def numbers2Sum = customSum(numbers2) <i class="conum" data-value="2"></i><b>(2)</b>
        def numbers3Sum = customSum(numbers3)
    then: 'Results should be the expected'
        numbers1Sum == 223
        numbers2Sum == 87
        numbers3Sum == 134
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We are creating a new function with a fixed type of filter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We have created a new function that sums all numbers greater than 20
and less than 200 for the collection passed as parameter</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
If the expression <strong><em>this.&amp;sum.rcurry</em></strong> sounds like chinese to you just take that this
expression is only saying: I want to get a new function with the first parameter from the right with
the following value <strong><em>{ it &gt; 20 &amp;&amp; it &lt; 100}</em></strong>. Anyway I recommend you to review the chaper
dedicated to closures.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_streams">4. Streams</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far, we&#8217;ve seen that in Groovy, filtering elements and applying transformation over
that collection is as easy as a pie right ? But we didn&#8217;t realize we could be more
efficient in the way we do those tasks.</p>
</div>
<div class="sect2">
<h3 id="_mind_the_lazyness">4.1. Mind the lazyness</h3>
<div class="paragraph">
<p>Imagine we want to filter even numbers from a given collection and then multiply them
10 times.</p>
</div>
<div class="listingblock">
<div class="title">Working more than you should</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Multiply even numbers 10 times'() {
    given: 'A collection of numbers'
        def numbers = (0..10)
    when: 'Filtering and transforming numbers'
        def result =
            numbers.
                findAll { it % 2 == 0}. <i class="conum" data-value="1"></i><b>(1)</b>
                collect { it * 10 } <i class="conum" data-value="2"></i><b>(2)</b>
    then: 'We should get the expected result'
        result == [0, 20, 40, 60, 80, 100]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We loop through the entire collection to get all required values</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The we loop through the filtered values to apply some transformation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It&#8217;s clear we should be able to loop only once the collection while applying the transformation only
to the required values. In this particular example is not critical, but imagine we were looping a collection with thousands
of elements, going through that collection more than once wouldn&#8217;t be very nice so to speak.</p>
</div>
<div class="paragraph">
<p>Let see what says the wikipedia about streams in this context:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>&#8230;A stream is a lazily evaluated or delayed sequence of data elements. A stream can be used
similarly to a list, but later elements are only calculated when needed. Streams can therefore
represent infinite sequences and series.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Wikipedia
</div>
</div>
<div class="paragraph">
<p>So how can we modify previous example to make it process the required values on the fly, as
soon as the process detectes they are suitable to be part of the result.</p>
</div>
<div class="paragraph">
<p>Later on we&#8217;ll see there&#8217;re at least a couple libraries that can do it for you in a
easy way. But for now we have to make do with Groovy alone.</p>
</div>
<div class="listingblock">
<div class="title">Two tasks at once</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Multiply even numbers 10 times lazily'() {
    given: 'A collection of numbers'
        def numbers = (0..10)
    when: 'Filtering and transforming numbers'
        def result =
            numbers.inject([]){ acc, val -&gt;
                if (val % 2 == 0) {
                    acc &lt;&lt; (val * 10)
                }
                acc
            }
    then: 'We should get the expected result'
        result == [0, 20, 40, 60, 80, 100]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have use the collection <strong><em>inject</em></strong> method. This method receives two arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initial value of the aggregated data</p>
</li>
<li>
<p>A closure receiving two parameters: the <strong><em>agregated data</em></strong>, and the <strong><em>next value</em></strong> of the source collection</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now the process declares which element the transformation has to be applied to and then add it to
the result. We don&#8217;t have to loop the collection twice we are doing both filtering and
transformation all at once.</p>
</div>
<div class="paragraph">
<p>Now we reached the goal, the process is more efficient but the problem is that I don&#8217;t like the
code, it&#8217;s not reusable.  So it&#8217;s time to change it.</p>
</div>
<div class="paragraph">
<p>I&#8217;ve based my implementation in the JDK8 Stream API. Of course this is a very basic implementation,
but it shows how lazy evaluation could be implemented.</p>
</div>
<div class="listingblock">
<div class="title">Simple Stream</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>package groovyfp.streams

final class Stream {

    final Collection&lt;?&gt; col
    Closure&lt;Boolean&gt; filter
    Closure&lt;?&gt; transformer

    Stream(Collection&lt;?&gt; col) {
       this.col = col
    }

    static Stream from(Collection&lt;?&gt; source) {
        return new Stream(source)
    }

    Stream filter(Closure&lt;Boolean&gt; filter) {
        this.filter = filter
        this
    }

    Stream map(Closure&lt;?&gt; transformer) {
        this.transformer = transformer
        this
    }

    Collection&lt;?&gt; collect() {
        return col.inject([]){ acc, val -&gt;
            if (filter(val)) {
                acc &lt;&lt; transformer(val)
            }
            acc
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most of the code initializes both the filter and transformer of the collection. But the interesting
part is in the <strong><em>collect()</em></strong> method:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The filter is applied to any element. If the element is suitable to be added to the result then&#8230;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The transformation is applied to the element, and finally the element is added to the result.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now if we change our test code, it should look like the following:</p>
</div>
<div class="listingblock">
<div class="title">Functional lazy</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Multiply even numbers 10 times lazily (nicer way)'() {
    given: 'A collection of numbers'
        def numbers = (0..10)
    when: 'Filtering and transforming numbers'
        def result =
            Stream.
                from(numbers).
                filter { it % 2 == 0 }.
                map { it * 10 }.collect()
    then: 'We should get the expected result'
        result == [0, 20, 40, 60, 80, 100]
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stream_groovy">4.2. stream-groovy</h3>
<div class="paragraph">
<p>It&#8217;s great to know to understand how to build lazy estructures, but it&#8217;s even better to use
libraries already created to do that work for you.</p>
</div>
<div class="paragraph">
<p><strong><em>Tim Yate&#8217;s</em></strong> <a href="http://timyates.github.io/groovy-stream/"><strong><em>stream-groovy</em></strong></a> is one of the libraries I will be reviewing in this chapter.
What&#8217;s this library for ?</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Groovy-stream is a library for Groovy that lets you create lazy Iterators (or streams) based on
Iterators, Collections, Maps, Iterables or other Streams.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; stream-groovy site
</div>
</div>
<div class="paragraph">
<p>Earlier I built a simple class that helped me to loop through a collection and filter data while
applying a single transformer. In other words I was able to create a stream for a single data set
and apply a single filter and transformer to the required values.</p>
</div>
<div class="paragraph">
<p>It was nice for that case but with many limitations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What if I want to combine <strong><em>more than one stream</em></strong> ?</p>
</li>
<li>
<p>What if I want to combine <strong><em>more than one filter</em></strong> ?</p>
</li>
<li>
<p>What if I want to combine <strong><em>more than one transfomer</em></strong> ?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Instead of reinventing the wheel lets see how <strong><em>stream-groovy</em></strong> can help you to do that.</p>
</div>
<div class="sect3">
<h4 id="_first_steps">4.2.1. First steps</h4>
<div class="listingblock">
<div class="title">stream-groovy getting started</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Getting double values from even numbers of a given collection'() {
    when: 'Processing the stream'
        def result =
            Stream.
                from(0..5). <i class="conum" data-value="1"></i><b>(1)</b>
                filter { it % 2 == 0 }. <i class="conum" data-value="2"></i><b>(2)</b>
                map { it * 10 }. <i class="conum" data-value="3"></i><b>(3)</b>
                collect() <i class="conum" data-value="4"></i><b>(4)</b>
    then: 'We should get the expected results'
        result == [0, 20, 40]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example looks pretty similar to example in the previus chapter right ? Busted!!! ;)</p>
</div>
<div class="paragraph">
<p>I&#8217;d like to point out some important parts:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We want to loop through a <strong><em>stream</em></strong>. A <strong><em>stream</em></strong> could be created using the different
overloaded versions of the <strong><em>from</em></strong> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Filtering the stream, and processing only the
values matching this expression. You will chose what elements to process thanks to the <strong><em>filter</em></strong>
method.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We&#8217;re applying a transformation. This time I want to get 10 times of every element in
the stream. You will normally use <strong><em>map</em></strong> to express a transformation.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Eventually I would like
to get the transformated data. Because the result of the transformation is an instance of Iterable I
can use methods such as collect(), next(), find(), findAll()</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_stream">4.3. Creating a Stream</h3>
<div class="paragraph">
<p>As I mentioned in the previous chapter your can start creating a stream using the method
<strong><em>Stream.from()</em></strong></p>
</div>
<div class="listingblock">
<div class="title">stream-groovy getting started</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Creating streams'() {
    when: 'building streams from collections and iterables'
        def stream1 = Stream.from({ x++ }).using(x: 1) <i class="conum" data-value="1"></i><b>(1)</b>
        def stream2 = Stream.from([1, 2, 3]) <i class="conum" data-value="2"></i><b>(2)</b>
        def stream3 = Stream.from(50..100) <i class="conum" data-value="3"></i><b>(3)</b>
        def stream4 = Stream.from(x: 0..2, y: 4..2) <i class="conum" data-value="4"></i><b>(4)</b>
    and: 'from an iterator instance'
        def x = 0
        def iterator = [hasNext: { true }, next: { x++ }] as Iterator
        def stream5 = Stream.from(iterator) <i class="conum" data-value="5"></i><b>(5)</b>
    and: 'also from another stream'
        def stream6 = Stream.from(stream1) <i class="conum" data-value="6"></i><b>(6)</b>
    then: 'values generated by the stream invocations'
        stream1.take(2).collect() == [1, 2]
        stream2.take(2).collect() == [1, 2]
        stream3.take(4).collect() == [50, 51, 52, 53]
        stream4.take(2).collect() == [[x:0, y:4], [x:0, y:3]]
    and: 'using until instead of take'
        stream5.until{ it &gt; 3}.collect() == [0, 1, 2, 3]
        stream6.until{ it &gt; 6}.collect() == [3, 4, 5, 6]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In general you can create a stream from an iterable instance such as collections, or any class
implementing java.util.Iterable, or creating a generator with the following expression:</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
Beware of not limiting the number of elements you want to receive from a generator.
You might be creating a infinite loop!!!
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_nba_time">4.4. NBA time</h3>
<div class="paragraph">
<p>This year I talked about functional programming at the Greach conference in Madrid and most of the
examples were about NBA games.</p>
</div>
<div class="paragraph">
<p>One of the examples were about getting the maximum difference in an NBA game of all times. I started
from an imperative style code, and then I was moving until getting a decent functional sample.</p>
</div>
<div class="paragraph">
<p>However I think I didn&#8217;t show how a lazy stream could beat the last example. Well it&#8217;s about time!!</p>
</div>
<div class="listingblock">
<div class="title">Non lazy approach</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Maximum difference in an NBA game: non lazy'() {
    when: 'Csv iterable'
        def result = csv
                .findAll(byDateFunction)
                .collect(differenceFunction)
                .max()
    then: 'The result should be the expected'
        result == 45
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the lazy counterpart:</p>
</div>
<div class="listingblock">
<div class="title">Lazy approach</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Maximum difference in an NBA game: lazy'() {
    when: 'Csv iterable'
        def result =
            Stream
                .from(csv)
                .filter(byDateFunction)
                .map(differenceFunction)
                .max()
    then: 'The result should be the expected'
        result == 45
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>I&#8217;ve used the same functions for filtering data and calculating the difference in every game for
both examples.</p>
</div>
<div class="listingblock">
<div class="title">Filter</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>def getByDateFunction() {
    return { row -&gt;
       row.date.endsWith('2013')
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Transformation</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>def getDifferenceFunction() {
    return { row -&gt;
        [row.homePoints, row.visitorPoints]*.
            toInteger().
            sort().
            with {
                last() - first()
            }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Altough this time I didn&#8217;t use the whole NBA data set, however results are clear, the non lazy
approach took more than twice as long as the lazy code.</p>
</div>
<div class="paragraph">
<p>So next time you think about lazyness&#8230;.well just keep this in mind&#8230;  maybe is not that bad after
all.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_oop_revisited">5. OOP Revisited</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most of the time is hard to think in terms of functional programming because we are not used to do
it. I was born as a programmer in OOP programming, and it&#8217;s now when I&#8217;ve started digging into
functional programming.</p>
</div>
<div class="paragraph">
<p>So I guess that a friendly way of travelling to the functional land would be to pass through some of
the object-oriented places we&#8217;ve been working on for the past 20 years. Do you want to join me in
this trip ? Lets go!</p>
</div>
<div class="paragraph">
<p>I&#8217;ve followed the list of oop patterns discussed in the book "Functional Programming Patterns" by
Michael Bevilaqua-Linn.</p>
</div>
<div class="paragraph">
<p>Object oriented languages that doesn&#8217;t have functions as first citizens have to make do with classes
and methods in order to be able to pass behavior to another classes or methods.</p>
</div>
<div class="sect2">
<h3 id="_replacing_functional_interface">5.1. Replacing Functional Interface</h3>
<div class="paragraph">
<p>The first example has to do with some of the topics we&#8217;ve seen so far. In previous chapters we&#8217;ve
been talking about how to filter and transform data with closures. Now we&#8217;re going to measure how
far we are from the times we only could pass behavior using classes and methods.</p>
</div>
<div class="paragraph">
<p>Don&#8217;t get me wrong, I&#8217;m not complaining, but we don&#8217;t have to do that anymore, do we ?</p>
</div>
<div class="paragraph">
<p>How could do we pass filtering behavior to a collection if we didn&#8217;t have closures ? I would start
by declaring an interface declaring the intent of the filter:</p>
</div>
<div class="listingblock">
<div class="title">Filter</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>package groovyfp.oop2fn

interface Filter&lt;T&gt; {
   Boolean accept(T element)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then of course an implementation:</p>
</div>
<div class="listingblock">
<div class="title">Filter implementation</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>package groovyfp.oop2fn

class EvenNumbersFilter implements Filter&lt;Integer&gt; {
    Boolean accept(Integer number) {
        return number % 2 == 0
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And that&#8217;s it. We can now use it:</p>
</div>
<div class="listingblock">
<div class="title">How to use the functional interface</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>List&lt;Integer&gt; filterNumbersByFilter(List&lt;Integer&gt; numbers, Filter&lt;Integer&gt; filter) {
    List&lt;Integer&gt; resultList = new ArrayList()

    for (Integer number : numbers) {
        if (filter.accept(number)) {
            resultList.add(number)
        }
    }

    return resultList
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">How to use the functional interface</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Functional Interface: the old fashioned way'() {
    given: 'a list of numbers'
        def numbers = (0..10)
    when: 'filtering using the class wrapping the filtering behavior'
        def evenNumbers = filterNumbersByFilter(numbers, new EvenNumbersFilter())
    then: 'We should get the expected result'
        evenNumbers == [0, 2, 4, 6, 8, 10]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now, how can we do the same in Groovy ? Well, in case we wanted to reuse the method receiving
the Filter instance we can use closures coercion:</p>
</div>
<div class="listingblock">
<div class="title">Closure coercion</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Functional Interface: closures coercion'() {
    given: 'a list of numbers'
        def numbers = (0..10)
    when: 'filtering using the class wrapping the filtering behavior'
        def filter = { it % 2 == 0 } as Filter <i class="conum" data-value="1"></i><b>(1)</b>
        def evenNumbers = filterNumbersByFilter(numbers, filter) <i class="conum" data-value="2"></i><b>(2)</b>
    then: 'We should get the expected result'
        evenNumbers == [0, 2, 4, 6, 8, 10]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creation of an instance that implements the functional interface. The body of the closure is
supposed to be the implementation of the only method that the interface had.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Then you can use it whenever you used to pass an instance of that object</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_state">5.2. State</h3>
<div class="paragraph">
<p>Closures have an important characteristic, which is they capture the "state" of the scope where they
were created.</p>
</div>
<div class="paragraph">
<p>IMHO the wrong way of thinking about this topic is the following example, which mutates
one of the references the closure is using.</p>
</div>
<div class="listingblock">
<div class="title">State (Wrong)</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'State: using state wrong'() {
    given: 'an object used in a closure'
        def state = new State(discount:50) <i class="conum" data-value="1"></i><b>(1)</b>
        def closure = { price -&gt;
            price * (state.discount / 100) <i class="conum" data-value="2"></i><b>(2)</b>
        }
    when: 'calculating the price discount'
        def result1 = closure(100)
    and: 'changing state value'
        state = new State(discount:20) <i class="conum" data-value="3"></i><b>(3)</b>
        def result2 = closure(100)
    then: 'the second result is different'
        result1 != result2
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We declare a given discount to apply to some prices.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The scope is so wide there is the risk someone could mutate the state reference value</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The worst happened. We mutated state and the result of calling the closure with the same
value changes. If you care about mutability, this is not good.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>How can we pass state without mutating references used by our closure. I&#8217;ve changed the
example a little bit:</p>
</div>
<div class="listingblock">
<div class="title">State</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'State: using state wrong'() {
    given: 'an object used in a closure'
        def state = new State(discount:50) <i class="conum" data-value="1"></i><b>(1)</b>
    and: 'reducing the closure avaiable scope when is created'
        def closure = { State st -&gt; <i class="conum" data-value="2"></i><b>(2)</b>
            return { price -&gt;
                price * (st.discount / 100)
            }
        }
    when: 'calculating the price discount'
        def closureWithImmutableState  = closure(state)
        def result1 = closureWithImmutableState(100)
    and: 'changing state value'
        state = new State(discount:20) <i class="conum" data-value="3"></i><b>(3)</b>
        def result2 = closureWithImmutableState(100)
    then: 'the second result is different'
        result1 == result2
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We declare the state at a given point</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We declare the closure, but notice that when the inner closure is created it only sees the
state when it was created nothing more.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>That&#8217;s way when the state variable mutates the execution of the closure remains the same</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_command">5.3. Command</h3>
<div class="paragraph">
<p>Command pattern normally wraps a certain behavior, and that behavior is passed to another function
or object to execute that behavior with the data found at the destination function or object.</p>
</div>
<div class="paragraph">
<p>Imagine I want to purchase online two tickets, and I can chose between paying the VIP tickets or the
regular ones. Depending on my choice the payment process will charge me differently.</p>
</div>
<div class="listingblock">
<div class="title">Object receiving command</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>package groovyfp.oop2fn

class PurchaseEntry {

    BigDecimal price

    BigDecimal applyPurchaseProcess(PurchaseProcess process) {
        return process.calculate(price)
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The purchase order has the normal price of the purchase, and depending on the process applied, the
final amount could be changed.</p>
</div>
<div class="listingblock">
<div class="title">Contract of the command</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>package groovyfp.oop2fn

interface PurchaseProcess {
    BigDecimal calculate(BigDecimal price)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All processes passed to the process entry, should comply to the PurchaseProcess interface. Remember
we can create a closure and coerce it to become a functional interface.</p>
</div>
<div class="listingblock">
<div class="title">Using command pattern</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Command: passing behavior to another class'() {
    given: 'a given purchase has a certain price'
        def purchaseEntry = new PurchaseEntry(price: 200) <i class="conum" data-value="1"></i><b>(1)</b>
    when: 'two different purchase processes'
        def result = purchaseEntry.applyPurchaseProcess(process) <i class="conum" data-value="2"></i><b>(2)</b>
    then: 'the price is the expected depending on the process'
        result == expectedPrice
    where: 'possible processes are'
        process                           | expectedPrice
        { price -&gt; price }                | 200 <i class="conum" data-value="3"></i><b>(3)</b>
        { price -&gt; price += price * 0.3 } | 260 <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initializing the entry with the initial price</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Applying each of the processes to check different values</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Declaring each process and the expected prices after applying those processes to the entry</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_immutable_objects_instead_of_builder">5.4. Immutable objects instead of Builder</h3>
<div class="paragraph">
<p>Six years ago I remember creating builder objects in Java not only because I was preserving
immutability (I didn&#8217;t care about it at that time) but also because using a builder with a fluent
API (using the chain pattern of course) was like using a DSL.</p>
</div>
<div class="paragraph">
<p>Nowadays with Groovy both of those "requirements" can be achieved by using the @Immutable
transformation and the fact that you can use maps when building new instances of an object.</p>
</div>
<div class="paragraph">
<p>We want to build and immutable object, or an object as immutable as it could be. Our object
carries information about a given video. Here is the Java-Style builder.</p>
</div>
<div class="listingblock">
<div class="title">Video</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>package groovyfp.oop2fn

import groovy.transform.TupleConstructor

@TupleConstructor
class Video {
    String name
    String type
    long length

    void setName(String name) {}
    void setType(String type) {}
    void setLength(Long length) {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to make Video object immutable (and not using @Immutable as we will see later on) I came
with this idea of forcing to create all possible constructors to be able to initialize class fields
using constructors and then overriding the setters.</p>
</div>
<div class="paragraph">
<p>I guess it would be easier if we could declare fields as private and Groovy would care about private
but so far it doesn&#8217;t. So even if the field is private you can access to it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Even in Java through the Reflection API you can access to the value of a private field.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next is the builder itself. It has a fluent API so if you use an IDE you will be please about
concatenating builder methods to initialize and build a new instance of Video class.</p>
</div>
<div class="listingblock">
<div class="title">Video Builder</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>package groovyfp.oop2fn

class VideoBuilder {

    String name
    String type
    Long length

    static VideoBuilder builder() {
        return new VideoBuilder()
    }

    VideoBuilder name(String name) {
        this.name = name
        return this
    }

    VideoBuilder type(String type) {
        this.name = name
        return this
    }

    VideoBuilder length(Long length) {
        this.length = length
        return this
    }

    Video build() {
        return new Video(name, type, length)
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally both classes interact together in the following specification.</p>
</div>
<div class="listingblock">
<div class="title">Using builder</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Immutability through Builder'() {
    given: 'an object built by a builder'
        def video =
            VideoBuilder
                .builder()
                .name('trip.avi')
                .type('mp4')
                .length(100000)
                .build()
    when: 'trying to mutate the object'
        video.name = 'anothervideo'
    then: 'the instance should not have been mutated'
        video.name == 'trip.avi'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a lot of code right ? Since Groovy 1.7 <strong><em>@Immutable</em></strong> annotation is avaiable. This
annotation applies an AST transformation to make your classes almost immutable. To see the
particulars of what <strong><em>@Immutable</em></strong> can do for you, I&#8217;d recommend you to check the GroovyDoc, it&#8217;s
very detailed.</p>
</div>
<div class="listingblock">
<div class="title">ImmutableVideo</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>package groovyfp.oop2fn

import groovy.transform.Immutable

@Immutable
class ImmutableVideo {
    String name
    String type
    long length
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Using @Immutable</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Immutability through @Immutable'() {
    given: 'an immutable instance'
        def video = new ImmutableVideo(
            name: 'video.mp4',
            type: 'mp4',
            length: 12434
        )
    when: 'trying to mutate the object'
        video.name = 'somethingelse.avi'
    then: 'an exception will be thrown'
        thrown(Exception)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The main difference between the Builder instance and the use of the @Immutable annotation is that
the use of the annotation will thrown an exception every time you try to access to any of the fields
of the anotated class, while the instance built with the builder will just ignore your attempts to
change the value of your fields.</p>
</div>
<div class="paragraph">
<p>Maybe there are more solutions to that problem, like a friend of mine says&#8230;.pull-requests are
welcome :-)</p>
</div>
</div>
<div class="sect2">
<h3 id="_replacing_iterator">5.5. Replacing Iterator</h3>
<div class="paragraph">
<p>Most of the ideas about this topic have been already discussed in <a href="3_iteration.html">Internal vs External Iteration</a>.</p>
</div>
<div class="paragraph">
<p>The only idea I want to touch here is <strong><em>sequence comprehensions</em></strong>.</p>
</div>
<div class="paragraph">
<p>Why comprehensions are so appealling. Have you ever tried to loop through two collections at a time
to get values combined ? I&#8217;m sure you have. How did it look like ? I bet it was pretty much like this:</p>
</div>
<div class="listingblock">
<div class="title">Looping hell</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Looping two collections at the same time'() {
    given: 'two different collections'
        def collection1 = (10..12)
        def collection2 = (60..62)
    and: 'the collection combining the result'
        def combination = []
    when: 'combining both collections'
        collection1.each { outer -&gt;
            collection2.each { inner -&gt;
               combination &lt;&lt; [outer, inner]
            }
        }
    then: 'values should be the expected'
        combination == [
            [10, 60],
            [10, 61],
            [10, 62],
            [11, 60],
            [11, 61],
            [11, 62],
            [12, 60],
            [12, 61],
            [12, 62]
        ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unfortunately Groovy doesn&#8217;t have comprehensions inbuilt in the language. But good news you have
some options. You can use <strong><em>Tim Yates'</em></strong> <a href="http://timyates.github.io/groovy-stream/"><strong><em>stream-groovy</em></strong></a> library which have among others some
comprehensions implementation.</p>
</div>
<div class="listingblock">
<div class="title">stream-groovy comprehensions</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Groovy comprehensions using stream-groovy'() {
    given: 'two different collections'
        def collection1 = (10..12)
        def collection2 = (60..62)
    when: 'combining both collections using stream-groovy'
        def combination =
            Stream
                .from(x: collection1, y: collection2)
                .map { [x, y] }
                .collect()
    then: 'the results should be the expected'
        combination == [
            [10, 60],
            [10, 61],
            [10, 62],
            [11, 60],
            [11, 61],
            [11, 62],
            [12, 60],
            [12, 61],
            [12, 62]
        ]
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_template_pattern">5.6. Template pattern</h3>
<div class="paragraph">
<p>The intent of the template pattern is to describe a process skeleton in an abstract class and let
subclasses to implement the behavior of some parts of the process.</p>
</div>
<div class="paragraph">
<p>The example we&#8217;re using is an imaginary financial calculation. Imagine a bank that depending on its
clients applies a different values for some parts of the calculations&#8230;weird right ?</p>
</div>
<div class="paragraph">
<p>Apart from the details the process is always the same adding up the amount,
the applied taxes and then possible extra costs.</p>
</div>
<div class="paragraph">
<p>First lets see how it would look like using a classical object oriented approach.</p>
</div>
<div class="listingblock">
<div class="title">Abstract class</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>package groovyfp.oop2fn

abstract class AbstractFinancialProcess {

    abstract Double calculateTaxes(Double amount)
    abstract Double calculateExtras(Double amount)

    Double calculate(Double amount) {
        return amount +
            calculateTaxes(amount) +
            calculateExtras(amount)
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For good clients the bank doesn&#8217;t charge much:</p>
</div>
<div class="listingblock">
<div class="title">Soft financial calculation</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>package groovyfp.oop2fn

class FinancialProcessSoft extends AbstractFinancialProcess {

    Double calculateTaxes(Double amount) {
        return amount * 0.01
    }

    Double calculateExtras(Double amount) {
        return amount * 0.2
    }

}
</code></pre>
</div>
</div>
<div class="paragraph">
<p>For bad clients the picture doesn&#8217;t look that well:</p>
</div>
<div class="listingblock">
<div class="title">Hard financial calculation</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>package groovyfp.oop2fn

class FinancialProcessHard extends AbstractFinancialProcess {

    Double calculateTaxes(Double amount) {
        return amount * 0.10
    }

    Double calculateExtras(Double amount) {
        return amount * 0.5
    }

}
</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then of course testing the process with these two implementations:</p>
</div>
<div class="listingblock">
<div class="title">Template pattern object oriented approach</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Classical template method implementation'() {
    given: 'One concrete subclass implementation'
        def softCalculation = new FinancialProcessSoft()
    and: 'another different implementation based in the same parent'
        def hardCalculation = new FinancialProcessHard()
    expect: 'both results differ using the same process'
        softCalculation.calculate(100) !=
        hardCalculation.calculate(100)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>So how to turn this pattern to a functional style of programming ?</p>
</div>
<div class="paragraph">
<p>Well the abstract class which represented the process could be translated to
a function (I meant a closure):</p>
</div>
<div class="listingblock">
<div class="title">Template now is a higher function</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>Closure&lt;Double&gt; calculate = {
        Closure&lt;Double&gt; calculateTaxes,
        Closure&lt;Double&gt; calculateExtras,
        Double amount -&gt;

    return amount + calculateTaxes(amount) + calculateExtras(amount)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we can create functions to "fill" the implementation gaps of this process</p>
</div>
<div class="listingblock">
<div class="title">Specific details</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>Closure&lt;Double&gt; calculateSoftTaxes = { Double amount -&gt;
    return amount * 0.01
}

Closure&lt;Double&gt; calculateSoftExtras = { Double amount -&gt;
    return amount * 0.2
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally we use the functions to calculate the final amount:</p>
</div>
<div class="listingblock">
<div class="title">Using functional template pattern</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Template pattern using functions'() {
    when: 'calculating using predefined functions'
        def result1 =
            calculate(
                calculateSoftTaxes,
                calculateSoftExtras,
                100
            )
    and: 'calculating using anonymous functions'
        def result2 =
            calculate(
                { amount -&gt; amount * 0.2 },
                { amount -&gt; amount * 0.10 },
                100
            )
    then: 'same process...different results...with less code'
        result1 != result2
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because we&#8217;re using functions we can be more flexible about how to compose and reuse
different combinations of functions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
By the way, in many of the examples variables are typed. This is intentional because I want
reader to know what the functions really return. Depending on the situation typing is really up to
you
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Building a reusable function on the fly</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Composing functions to reuse templates'() {
    when: 'building a preset calculation'
        Closure&lt;Double&gt; customCalculation = { Double amount -&gt;
            calculate(
                calculateSoftTaxes,
                calculateSoftExtras,
                amount
            )
        }
    then: 'you can reuse it along your code'
        customCalculation(100) == 121.0
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_strategy">5.7. Strategy</h3>
<div class="paragraph">
<p>The intent of this pattern is to declare a process that uses an algoritm that can be implemented in
several ways</p>
</div>
<div class="paragraph">
<p>Lets say we are working in a video cassette company (an we&#8217;re in the 90&#8217;s :P). We belong to the
quality department and we want to filter those videos not passing minimal standard validation. But
the problem is that depending on the country the minimal validation changes.</p>
</div>
<div class="listingblock">
<div class="title">Different strategies</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>
List&lt;ImmutableVideo&gt; findAllFaultyVideo(List&lt;ImmutableVideo&gt; videoList, Closure&lt;Boolean&gt; validationStrategy) {
    return videoList.findAll(validationStrategy)
}

Closure&lt;Boolean&gt; validationStrategy1 = { ImmutableVideo video -&gt; video.type == 'mp4' }
Closure&lt;Boolean&gt; validationStrategy2 = { ImmutableVideo video -&gt; video.length &lt; 700  }
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Strategy test</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>void 'Changing the validation strategy'() {
    given:'A list of cars'
        List&lt;ImmutableVideo&gt; videoList = [
            [name: 'video1', type: 'avi', length: 1000],
            [name: 'video2', type: 'mp4', length: 1000],
            [name: 'video3', type: 'avi', length: 500] ,
            [name: 'video4', type: 'mp4', length: 1000],
            [name: 'video5', type: 'mp4', length: 50]
        ].asImmutable() as ImmutableVideo[]
    when: 'applying different strategies to the same list'
        def videoResultList1 = findAllFaultyVideo(videoList, validationStrategy1)
        def videoResultList2 = findAllFaultyVideo(videoList, validationStrategy2)
    then: 'you will have different result size'
        videoResultList1.size() == 3
        videoResultList2.size() == 2
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_functional_patterns">6. Functional Patterns</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(TODO)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_m_word">7. The M-Word</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(TODO)</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2014-06-27 00:15:02 CEST
</div>
</div>
</body>
</html>