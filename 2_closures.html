<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.0">
<title>Closures</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic|Noto+Serif:400,400italic,700,700italic|Droid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic|Noto+Serif:400,400italic,700,700italic|Droid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-check-square-o:first-child,ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after,a[href^="mailto:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_closures">Closures</a>
<ul class="sectlevel2">
<li><a href="#_definition">Definition</a></li>
<li><a href="#_getting_started">Getting started</a></li>
<li><a href="#_composition">Composition</a></li>
<li><a href="#_currying">Currying</a>
<ul class="sectlevel3">
<li><a href="#_what_is_currying">What is currying ?</a></li>
<li><a href="#_using_curry_ncurry_rcurry">Using curry, ncurry, rcurry</a></li>
<li><a href="#_combining_closures">Combining closures</a></li>
</ul>
</li>
<li><a href="#_delegation_strategy">Delegation strategy</a>
<ul class="sectlevel3">
<li><a href="#_owner_first">OWNER FIRST</a></li>
<li><a href="#_owner_only">OWNER_ONLY</a></li>
<li><a href="#_delegate_first">DELEGATE FIRST</a></li>
<li><a href="#_delegate_owner">DELEGATE_OWNER</a></li>
</ul>
</li>
<li><a href="#_memoization">Memoization</a></li>
<li><a href="#_trampoline">Trampoline</a></li>
<li><a href="#_functional_interface_coercion">Functional interface coercion</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_closures">Closures</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_definition">Definition</h3>
<div class="paragraph">
<p>Until I find a better definition, I came up with the following "informal" definition:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A <strong><em>closure</em></strong> is a function which allows access to variables declared in its surrounding scope when
the closure was declared.</p>
</div>
<div class="paragraph">
<p>Normally this surrounding scope in Groovy means local variables and non-local variables inside its
upper lexical scopes up to class fields.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The minimal version of a closure could be:</p>
</div>
<div class="listingblock">
<div class="title">Declaring a closure</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures1,indent=0]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A closure may have closure aguments</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A closure body may have statements</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A closure may have an implicit variable</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Closures always return a value (even though it could be void).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Closures can be declared in as class fields, static fields, and local variables.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
I&#8217;ve included the typed version because sometimes people forgot about the fact that a closure is a
function, and like any other function it could return something.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Lets review the principals of a closure:</p>
</div>
<div class="listingblock">
<div class="title">Using a closure</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures2,indent=0]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A closure can access non-local variables available in upper lexical scopes when the closure was declared</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A closure can access local variables</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Has its own execution body</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Because it is a function, can be executed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Closures may reference variables external to their own definition. This includes local variables,
method parameters, and object instance members. However, a closure may only reference those
variables that the compiler can lexically deduce from the physical location of the closure
definition within the source file.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It&#8217;s very important to keep in mind that a closure "sees" those variables available when the closure
was declared, not when it&#8217;s used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_getting_started">Getting started</h3>
<div class="paragraph">
<p>Closures are widely used in Groovy. One of the most common places are collections. In the
following example we want to get 2 times each element of the collection.</p>
</div>
<div class="listingblock">
<div class="title">Using closures in API</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures3,indent=0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The collect method receives a parameter of type <strong><em>Closure</em></strong> that transforms every item in
the collection.</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Anonymous closure with implicit variable. In this case the variable refers to every
element in the collection.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also declare the closure and use it later as a parameter to another function.</p>
</div>
<div class="listingblock">
<div class="title">Using closures in API</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures4,indent=0]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declaring the closure</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Passing closures as parameters to other functions (closures or methods)</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_composition">Composition</h3>
<div class="paragraph">
<p>Sometimes we end with a lot of functions used all over the code, but many
times used in different ways, orders&#8230;&#8203;etc.</p>
</div>
<div class="paragraph">
<p>Imagine you have a problem and you only know there will be two numbers
as an input and the result will be decimal. Your boss tells you to
add them up until he knows what the final calculation will be.</p>
</div>
<div class="paragraph">
<p>Well it&#8217;s not that bad isn&#8217;t it ? It is going to be a simple sum, lets
hardcode it and leave it alone.</p>
</div>
<div class="listingblock">
<div class="title">Harcoding solution which is likely to change</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures5,indent=0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now your boss comes again and gives you the whole formula: All numbers should be
multiplied 2 times and then be divided by 10 and eventually yes they should be
added up.</p>
</div>
<div class="paragraph">
<p>Ok, now you have to modify your code:</p>
</div>
<div class="listingblock">
<div class="title">Modifying your logic</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures6,indent=0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may be thinking the code is still legibible and there is nothing wrong to
keep it that way. Well I disagree. First of all you are looping the collection
twice, that could be a lot of numbers, be carefull with that. And the second &#8230;&#8203;
will see that later ;)</p>
</div>
<div class="paragraph">
<p>I&#8217;m going to compose first two functions to be applied only once per item before
adding up all numbers.</p>
</div>
<div class="listingblock">
<div class="title">Composing</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures7,indent=0]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declaring first part of the calculation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declaring second part of the calculation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Combining both of them. Execution will be from left to right. First multiplication,
then division</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Using the combined function per each item</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Composition could be done from left to right or the other way around, it depends on the developer&#8217;s
decision. But this has to change a little bit more. We still have our functions</p>
</div>
<div class="listingblock">
<div class="title">Composing</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures8,indent=0]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>I&#8217;ve moved functions that I will probably reuse to static methods. That way I can
combine them without harcode them in my methods</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In this method I describe the problem I&#8217;ve been dealing with. Applying a function
to a list of numbers that eventually are going to be added up.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>I&#8217;m using the composed function here</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>At this point I&#8217;m able to reuse the basic functionality to apply any single or
combined function to it.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_currying">Currying</h3>
<div class="sect3">
<h4 id="_what_is_currying">What is currying ?</h4>
<div class="paragraph">
<p>The term takes its name from the american mathematician Haskell Curry. A good formal definition
could be:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Currying is the technique of transforming a function that takes multiple arguments in such a way
that it can be called as a chain of functions each with a single argument.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Wikipedia
</div>
</div>
<div class="paragraph">
<p><em>Currying</em> is a special case of <strong><em>partial application</em></strong> which is:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In computer science, partial application (or partial function application) refers to the process of
fixing a number of arguments to a function, producing another function of smaller arity&#8230;&#8203;</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Wikipedia
</div>
</div>
<div class="paragraph">
<p>Why are both definitions important ? Well, although I&#8217;ve just showed you the formal definition of
both <em>currying</em> and <em>partial application</em> in Groovy we tend to use the term <em>currying</em> most of the
time meaning partial applications. From now on I will using the formal definitions mentioned above.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_curry_ncurry_rcurry">Using curry, ncurry, rcurry</h4>
<div class="paragraph">
<p>There are three specialized methods for the Closure type in order to produce
partial applications of your closures.</p>
</div>
<div class="paragraph">
<p>The first one is <strong><em>curry</em></strong>. This method takes a var-arg parameter in order to set any number of
available closure parameters and return the partial application of it.</p>
</div>
<div class="listingblock">
<div class="title">curry(&#8230;&#8203;)</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures14,indent=0]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A function having 3 parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We set the first parameter of the source function producing a new function with
two parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This time we may want to set all parameters to pospone the execution of the function</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using <strong><em>curry(&#8230;&#8203;)</em></strong> you can pass at most the same number of arguments of the source closure,
otherwise you will get an IllegalAgumentException. The parameters are set from left to right.</p>
</div>
<div class="paragraph">
<p>In case you wanted to produce partial applications of a given function applying fixed values
from right to left, then you should be using <strong><em>rcurry(&#8230;&#8203;)</em></strong> method.</p>
</div>
<div class="listingblock">
<div class="title">rcurry(&#8230;&#8203;)</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures15,indent=0]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong><em>rcurry</em></strong> may seem a little bit awkward because notice how parameters are passed
to <em>rcurry</em>. One may expect to keep inverse order from right to left, I mean&#8230;&#8203;
if we had this function:</p>
</div>
<div class="listingblock">
<div class="title">rcurry(&#8230;&#8203;) explanation</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def myFunction = { String a, Integer b, Double c -&gt; /*...*/ }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we wanted to set two fixed parameters I may expect that rcurry should be applied like this:</p>
</div>
<div class="listingblock">
<div class="title">rcurry(&#8230;&#8203;) wrong use</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">// WRONG
def myFunction2 = myFunction1.rcurry(22.2, 3)</code></pre>
</div>
</div>
<div class="paragraph">
<p>But instead <em>rcurry</em> expects to kee the same order:</p>
</div>
<div class="listingblock">
<div class="title">rcurry(&#8230;&#8203;) correct</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">// CORRECT
def myFunction2 = myFunction1.rcurry(3, 22.2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Last but not least. If you would like to produce a partial application of a given closure for any
parameter at any position you can use <strong><em>ncurry</em></strong>.</p>
</div>
<div class="listingblock">
<div class="title">ncurry(&#8230;&#8203;)</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures16,indent=0]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we want to set only the second parameter from the left hand side.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using <strong><em>ncurry</em></strong> you just place the cursor at a given point and start setting
fixed parameters from left to right.</p>
</div>
</div>
<div class="sect3">
<h4 id="_combining_closures">Combining closures</h4>
<div class="paragraph">
<p>The same way we wanted to compose functions to transform values, we may want to
do the same thing with filtering.</p>
</div>
<div class="paragraph">
<p>This time we will change perspective. Instead of applying composed filters I think it would be more
interesting how to aggregate filters in order to apply them, for example, to a collection.</p>
</div>
<div class="paragraph">
<p>Think about an SQL operation, we wouln&#8217;t want the database engine to apply
each filter for every row and aggregate the result from the previous execution, Would we?
That would be crazy ? So if the database engine doesn&#8217;t do it, neither do I.</p>
</div>
<div class="paragraph">
<p>Our starting point is the less efective implementation where we&#8217;re repeating our
loop per each filter</p>
</div>
<div class="listingblock">
<div class="title">Filtering several times</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures9,indent=0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>I can&#8217;t combine both filters as I did with transformation in the previous chapter.  Because the
result of applying a filter is a boolean value. Than boolean value will be passed as the argument of
the next function in line, and it will fail because all our filters are expecting a number.</p>
</div>
<div class="paragraph">
<p>The strategy requires to apply a partial application of the function.  Let&#8217;s show how to do it with
normal <strong><em>Xcurry</em></strong> methods.</p>
</div>
<div class="listingblock">
<div class="title">Combining filters using rcurry</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures10,indent=0]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>First we create a closure with two parameters. We need to add some filters. All filters should be executed for every number</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We need to use rcurry to set filters, because var-args arguments can only be the last parameter of a function</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Passing all filter we want to apply in order</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Filtering numbers</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we will be applying all filters for every single item, just once. We made
our filtering process more efficient. Well done !!</p>
</div>
<div class="paragraph">
<p>It&#8217;s true that sometimes it&#8217;s a little bit verbose to use <em>Xcurry(&#8230;&#8203;)</em> methods but
it&#8217;s also true that using that technique functions are more reusable.</p>
</div>
<div class="paragraph">
<p>Here there is another technique which consist of making functions return other functions. Eventually
is what <em>Xcurry(&#8230;&#8203;)</em> methods will do for you underneath, but sometimes may look clearer to the reader what
the partial application tries to do.</p>
</div>
<div class="listingblock">
<div class="title">Combining filters making a closure to return another closure</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures11,indent=0]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In just one call we are using the behavior of closures to set the filters we will be
using without having to use any Xcurry function</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Passing all filter we want to apply in order</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Filtering numbers</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Why can I do step number 1 ? Because the closure&#8217;s <strong>filter</strong> value is set when the closure is
declared with the references at that time.  Afterwards those values won&#8217;t change. Anyway I made sure
that couln&#8217;t happen because I declare <strong><em>filters</em></strong> as a <strong><em>final</em></strong> parameter.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_delegation_strategy">Delegation strategy</h3>
<div class="paragraph">
<p>Closures can use different strategies to resolve some property references and methods.
Before talking about strategies, and how to change the order of resolution,
there are some important concepts we must know up front.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Definition of every concept is taken from the Closure javadoc at
<a href="http://groovy.codehaus.org/api/groovy/lang/Closure.html" class="bare">http://groovy.codehaus.org/api/groovy/lang/Closure.html</a>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>delegate : the delegate Object to which method calls will
go which is typically the outer class when the closure is constructed</p>
</li>
<li>
<p>owner : the owner Object to which method calls will go which is
typically the outer class when the closure is constructed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>I want you to notice how many times the word <strong>typically</strong> is used. Here it would
mean <strong><em>everything will happen this way if the default resolution strategy is used</em></strong></p>
</div>
<div class="paragraph">
<p>There are 4 different strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OWNER_FIRST : <strong>(default)</strong> With this resolveStrategy set the closure will attempt to
resolve property references and methods to the owner first,
then the delegate.</p>
</li>
<li>
<p>OWNER_ONLY : With this resolveStrategy set the closure will resolve property
references and methods to the owner only and not call the delegate at all.</p>
</li>
<li>
<p>DELEGATE_FIRST : With this resolveStrategy set the closure will attempt to
resolve property references and methods to the delegate first then the owner.</p>
</li>
<li>
<p>DELEGATE_ONLY : With this resolveStrategy set the closure will resolve
property references and methods to the delegate only and entirely bypass the owner</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Strategies definition have been taken from the Closure javadoc at
<a href="http://groovy.codehaus.org/api/groovy/lang/Closure.html" class="bare">http://groovy.codehaus.org/api/groovy/lang/Closure.html</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The basic idea here is that we can change the order of the resolution of property
references and methods. But before getting into detail of every one of them,
I would like to know what is the normal resolution behavior of a Closure.
In order to do that lets see this example:</p>
</div>
<div class="listingblock">
<div class="title">Lexical scope</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures21,indent=0]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Lexical scope</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures20,indent=0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It seems that the closure follows lexical scope:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>First tries to resolve in the closure scope</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>then goes up, to the local scope</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and finally goes up again until reaches the class instance scope</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>But wait. I said default strategy was OWNER_FIRST then&#8230;&#8203; why some of the
variables are resolved by lexical scope ? Well I came up with the following
example to help me to understand how the variables are resolved. As you may
notice local variables always win vs strategies. Only global and
delegate scope can be influenced by changing the resolution strategy.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Resolution</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1st</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2nd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3th</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4th</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OWNER_FIRST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">local 2 closure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">local</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delegate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OWNER_ONLY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">local 2 closure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">local</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELEGATE_FIRST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">local 2 closure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">local</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delegate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELEGATE_ONLY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">local 2 closure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">local</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delegate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>With this table as a cheatsheet I&#8217;m going to do some examples of all
strategies listed before.</p>
</div>
<div class="sect3">
<h4 id="_owner_first">OWNER FIRST</h4>
<div class="paragraph">
<p>(TODO)</p>
</div>
</div>
<div class="sect3">
<h4 id="_owner_only">OWNER_ONLY</h4>
<div class="paragraph">
<p>(TODO)</p>
</div>
</div>
<div class="sect3">
<h4 id="_delegate_first">DELEGATE FIRST</h4>
<div class="paragraph">
<p>(TODO)</p>
</div>
</div>
<div class="sect3">
<h4 id="_delegate_owner">DELEGATE_OWNER</h4>
<div class="paragraph">
<p>(TODO)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_memoization">Memoization</h3>
<div class="paragraph">
<p>Although memoization is normally used for recursive calculations&#8230;&#8203;
don&#8217;t worry, this chapter doesn&#8217;t start with "yet another Fibonacci example".</p>
</div>
<div class="paragraph">
<p>We&#8217;ll get there, but I think is easier to think about memoization as a form
of caching. A very simple one but caching nevertheless.</p>
</div>
<div class="paragraph">
<p>Imagine a very simple scenario. I would like a very simple cache to save
n calls to&#8230;&#8203;database/network/&#8230;&#8203;etc and it&#8217;s so simple I would waste my
time to use any fancy cache system.</p>
</div>
<div class="paragraph">
<p>In this first example, I&#8217;m simulating a way of getting users from a UserService
class with a method findUserById returning users having the id passed as parameter.</p>
</div>
<div class="paragraph">
<p>Because I know memory is far more than the memory need to store all users in
the given process, and because every call to that method really consumes a lot
of time, I&#8217;ve decided to memoize it.</p>
</div>
<div class="listingblock">
<div class="title">Memoized method</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures18,indent=0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to cache the method invocation I annotated the method with the annotation
groovy.transform.Memoize which creates a new cache at instance level.</p>
</div>
<div class="listingblock">
<div class="title">Memoized method</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures17,indent=0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This was an easy way of turning an existing method to a method with an "extra" cache.
But what if we wanted to use a closure with the same feature.</p>
</div>
<div class="paragraph">
<p>Imagine we want to create a MD5 signature of every of a given list. It&#8217;s
clear same word will become the same hash, so why bothering doing the calculation
if we already know the outcome ?</p>
</div>
<div class="listingblock">
<div class="title">Memoized closure</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures19,indent=0]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>I will be printing every word to notice that, at some point, some of the
invocation will be omitted.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In order to create a cache-included-closure we need to call memoized()
method from Closure class and most important, use the closure returned by
that method.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Then we can use that closure in a more efficient way :)</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_trampoline">Trampoline</h3>
<div class="paragraph">
<p>When writing recursive code, sometimes we can overflow the size of the stack and get and
Stackoverflow exception. To prevent that situation, Groovy gives us two solutions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Closure&#8217;s <strong><em>trampoline()</em></strong> method</p>
</li>
<li>
<p><strong><em>@TailRecursion</em></strong> AST transformation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A good example is to try to add up a list of numbers recursively.</p>
</div>
<div class="listingblock">
<div class="title">Recursion with trampoline()</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures12,indent=0]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We need to declare sumRecursively and then attach its behabior to the actual variable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Within the function every time we make a recursive call we must call to the "trampoline"
version of the function</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Finally to init the whole process execute a "trampoline" version of the closure</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It works ok but it seems a little bit complicated. Get a version with trampoline()
then not forget to call trampoline with arguments&#8230;&#8203;mmmmm</p>
</div>
<div class="paragraph">
<p><strong><em>@TailRecursive</em></strong> transformation helps you to avoid dealing with that kind of details.
You just focus on the implementation and it handles how to make the function to a
recursive one. This AST transformation is avaiable since version 2.3 of Groovy.</p>
</div>
<div class="paragraph">
<p>The only requirement here is to put the recursive call as the last expression in the
method body (at the tail, that&#8217;s why it&#8217;s called tail recursion optimization).</p>
</div>
<div class="listingblock">
<div class="title">Recursion with @TailRecursive</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/closures/ClosuresSpec.groovy[tags=closures13,indent=0]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_functional_interface_coercion">Functional interface coercion</h3>
<div class="paragraph">
<p>How do we used to pass filtering behavior to a collection if we didn&#8217;t have closures ? I&#8217;d started
by declaring an interface declaring the intent of the filter:</p>
</div>
<div class="listingblock">
<div class="title">Filter</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{sourceDir}/groovyfp/oop2fn/Filter.groovy[indent=0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then of course an implementation:</p>
</div>
<div class="listingblock">
<div class="title">Filter implementation</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{sourceDir}/groovyfp/oop2fn/EvenNumbersFilter.groovy[indent=0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And that&#8217;s it. We can now use it:</p>
</div>
<div class="listingblock">
<div class="title">How to use the functional interface</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/oop2fn/ObjectOrientedPatternsSpec.groovy[tags=oop2fn_2,indent=0]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">How to use the functional interface</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/oop2fn/ObjectOrientedPatternsSpec.groovy[tags=oop2fn_1,indent=0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now, how can we do the same in Groovy ? Well, in case we wanted to reuse the method receiving
the Filter instance we can use closures coercion:</p>
</div>
<div class="listingblock">
<div class="title">Closure coercion</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in 2_closures.ad - include::{testDir}/groovyfp/oop2fn/ObjectOrientedPatternsSpec.groovy[tags=oop2fn_3,indent=0]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creation of an instance that implements the functional interface. The body of the closure is
supposed to be the implementation of the only method that the interface had.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Then you can use it whenever you used to pass an instance of that object</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2014-10-16 22:24:13 +00:00
</div>
</div>
</body>
</html>